"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(f){return typeof f}:function(f){return f&&"function"==typeof Symbol&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f};function _classCallCheck(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")}(function(f,g){var l=Symbol("loop"),m=Symbol("init"),n=f.requestAnimationFrame||f.webkitRequestAnimationFrame,o=function(){function u(z){var A=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,u),this.save=[],this.canvas=z,this.cxt=z.getContext("2d"),this.width=0,this.height=0,this.rows={slide:[],top:[],bottom:[]},this.filters={},this.leftTime=A.leftTime||2e3,this.space=A.space||10,this.unitHeight=0,this.rowNum=0,this.baseSpeed=A.baseSpeed||2,this.baseWidth=A.baseWidth||800,this.startIndex=0,this.looped=!1,this.changeStyle(A)}return u.prototype.add=function add(z){z&&(this.looped&&this.countWidth([z]),this.filter(z),this.save.push(z))},u.prototype.clear=function clear(){this.save=[],this.startIndex=0},u.prototype.pause=function pause(){this.paused=!0},u.prototype.run=function run(){this.paused=!1},u.prototype.addFilter=function addFilter(z,A){if(!z||!A)return!1;var _ref=[this.filters],B=_ref[0];B[z]||(B[z]=[]),B[z].find(function(C){return A===C})||B[z].push(A),this.doFilter()},u.prototype.filter=function filter(z){for(var A=this.filters,B=Object.keys(A),C=Array.isArray(B),D=0,B=C?B:B[Symbol.iterator]();;){var E;if(C){if(D>=B.length)break;E=B[D++]}else{if(D=B.next(),D.done)break;E=D.value}for(var F=E,G=A[F],_ref3=[0,G.length],H=_ref3[0],I=_ref3[1];H<I;H++){if(!z[F].includes(G[H])){z.hide=!1;continue}return z.hide=!0,!1}}},u.prototype.doFilter=function doFilter(){for(var _ref4=[0,this.save],z=_ref4[0],A=_ref4[1],B=_ref4[2];B=A[z++];)this.filter(B)},u.prototype.removeFilter=function removeFilter(z,A){if(!z)return!1;var _ref5=[this.filters],B=_ref5[0],C=_ref5[1];if(C=B[z],!C)return!1;if(!A)delete B[z];else for(var _ref6=[0,C],D=_ref6[0],E=_ref6[1],F=_ref6[2];F=E[D++];)if(F===A){B[z].splice(D-1,1);break}this.doFilter()},u.prototype.clearRect=function clearRect(){this.cxt.clearRect(0,0,this.width,this.height)},u.prototype.font=function font(){this.globalFont=this.globalStyle+" "+this.globalWeight+" "+this.globalSize+" "+this.globalFamily},u.prototype.addGradient=function addGradient(z){var A=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!z||"string"!=typeof z)return!1;var B=null;if("radial"==z)B=this.addRadialGradient(A);else if("linear"==z)B=this.addLinearGradient(A);else return!1;this.changeStyle({fontColor:B})},u.prototype.addLinearGradient=function addLinearGradient(z){for(var A=z.startX||0,B=z.startY||0,C=z.endX||this.width,D=z.endY||this.height,E=z.colorStops||[{point:0,color:this.globalColor},{point:1,color:this.globalColor}],F=this.cxt.createLinearGradient(A,B,C,D),G=E,H=Array.isArray(G),I=0,G=H?G:G[Symbol.iterator]();;){var J;if(H){if(I>=G.length)break;J=G[I++]}else{if(I=G.next(),I.done)break;J=I.value}var K=J;F.addColorStop(K.point,K.color)}return F},u.prototype.addRadialGradient=function addRadialGradient(z){for(var A=z.startX||this.width/2,B=z.startY||this.height/2,C=z.startR||0,D=z.endX||this.width/2,E=z.endY||this.height/2,F=z.endR||this.width,G=z.colorStops||[{point:0,color:this.globalColor},{point:1,color:this.globalColor}],H=this.cxt.createRadialGradient(A,B,C,D,E,F),I=G,J=Array.isArray(I),K=0,I=J?I:I[Symbol.iterator]();;){var L;if(J){if(K>=I.length)break;L=I[K++]}else{if(K=I.next(),K.done)break;L=K.value}var M=L;H.addColorStop(M.point,M.color)}return H},u.prototype.changeStyle=function changeStyle(){var z=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.globalSize=z.fontSize||this.globalSize||"24px",this.globalFamily=z.fontFamily||this.globalFamily||"\u5FAE\u8F6F\u96C5\u9ED1",this.globalStyle=z.fontStyle||this.globalStyle||"normal",this.globalWeight=z.fontWeight||this.globalWeight||"normal",this.globalColor=z.fontColor||this.globalColor||"#ffffff",this.opacity=z.opacity||this.opacity||1,this.globalChanged=!0},u.prototype.initStyle=function initStyle(z){this.globalChanged=!1,this.font(),z.font=this.globalFont,z.textBaseline="middle",z.fillStyle=this.globalColor,z.globalAlpha=this.opacity},u.prototype.update=function update(z,A,B){var _ref9=[this.save,this.cxt],C=_ref9[0],D=_ref9[1];if(this.globalChanged&&this.initStyle(D),this.looped||this.countWidth(C),this.paused)return!1;this.refresh(C);var _ref10=[this.startIndex],E=_ref10[0],F=_ref10[1];for(D.clearRect(0,0,z,A);F=C[E++];)this.step(F,B),this.draw(F,D),this.recovery(F,z)},u.prototype.reset=function reset(){for(var E=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,_ref11=[this.save,this.width,this.leftTime,E],z=_ref11[0],A=_ref11[1],B=_ref11[2],C=_ref11[3],D=_ref11[4];D=z[C++];)"slide"==D.type?(D.x=A,D.rowRid=!1):D.leftTime=B,D.recovery=!1;this.startIndex=E},u.prototype.getSize=function getSize(){this.width=this.canvas.width,this.height=this.canvas.height,this.speedScale=g.max(this.width/this.baseWidth,0.7),this.deleteRow(),this.countRows(),this.globalChanged=!0},u.prototype.deleteRow=function deleteRow(){for(var _ref12=[this.save,0],z=_ref12[0],A=_ref12[1],B=_ref12[2];B=z[A++];)B.row=null},u.prototype.countRows=function countRows(){for(var B=parseInt(this.globalSize)+this.space,_ref13=[(this.height-20)/B>>0,this.rows],z=_ref13[0],A=_ref13[1],C=Object.keys(A),D=Array.isArray(C),E=0,C=D?C:C[Symbol.iterator]();;){var F;if(D){if(E>=C.length)break;F=C[E++]}else{if(E=C.next(),E.done)break;F=E.value}var I=F;A[I]=[]}for(var H,G=0;G<z;G++)H={idx:G,y:B*G+20},A.slide.push(H),G>=z/2?A.bottom.push(H):A.top.push(H);this.unitHeight=B,this.rowNum=z},u.prototype.getRow=function getRow(z){if(z.row)return z.row;var _ref15=[this.rows,z.type],A=_ref15[0],B=_ref15[1],C="bottom"==B?A[B].pop():A[B].shift(),D=this["getRow_"+B]();return C&&"slide"==z.type&&(z.x+=8*C.idx,z.speed+=C.idx/3),C||D},u.prototype.getRow_bottom=function getRow_bottom(){return{y:20+this.unitHeight*(g.random()*this.rowNum/2+this.rowNum/2<<0),speedChange:!1,tempItem:!0}},u.prototype.getRow_slide=function getRow_slide(){return{y:20+this.unitHeight*(g.random()*this.rowNum<<0),speedChange:!0,tempItem:!0}},u.prototype.getRow_top=function getRow_top(){return{y:20+this.unitHeight*(g.random()*this.rowNum/2<<0),speedChange:!1,tempItem:!0}},u.prototype.countWidth=function countWidth(z){var D=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.cxt;this.looped=!0;for(var E,_ref16=[this.width,0],A=_ref16[0],B=_ref16[1],C=_ref16[2];C=z[B++];)E=D.measureText(C.text).width>>0,C.width=E,C.height=parseInt(this.globalSize),C.x=A,C.speed=this.baseSpeed,"slide"!=C.type&&(C.x=(A-E)/2,C.leftTime=this.leftTime,C.speed=0)},u.prototype.updateStyle=function updateStyle(z,A){A.font=this.globalStyle+" "+this.globalWeight+" "+z.fontSize+" "+this.globalFamily,A.fillStyle=z.color||this.globalColor},u.prototype.step=function step(z,A){var B=this.getRow(z);B.speedChange&&(B.speedChange=!1,z.speed+=2*g.random()+1>>0);var C=z.speed*this.speedScale*A/16>>0;z.leftTime?z.leftTime-=A:"",z.x-=C,z.y=z.y||B.y,z.row=B},u.prototype.draw=function draw(z,A){return z.recovery||z.hide?!1:void(A.save(),z.change&&this.updateStyle(z,A),A.fillText(z.text,z.x,z.y),A.restore())},u.prototype.recovery=function recovery(z,A){return"slide"==z.type?(z.recovery=this.recoverySlide(z,A),!1):void(z.recovery=this.recoveryStatic(z))},u.prototype.recoverySlide=function recoverySlide(z,A){var _ref17=[z.x,z.width],B=_ref17[0],C=_ref17[1];return z.rowRid||!(B+C<A)||z.row.tempItem||(this.rows[z.type].unshift(z.row),z.rowRid=!0),!(B>-C)},u.prototype.recoveryStatic=function recoveryStatic(z){if(0<z.leftTime)return!1;var A=z.type;return z.row.tempItem||(this.rows[A].unshift(z.row),z.row=null),!0},u.prototype.refresh=function refresh(z){for(var _ref18=[this.startIndex,,this.rows],A=_ref18[0],B=_ref18[1],C=_ref18[2],D=Object.keys(C),E=Array.isArray(D),F=0,D=E?D:D[Symbol.iterator]();;){var G;if(E){if(F>=D.length)break;G=D[F++]}else{if(F=D.next(),F.done)break;G=F.value}var H=G;C[H].sort(function(I,J){return I.y-J.y})}for(;B=z[A++];){if(!B.recovery)return!1;this.startIndex=A,B.row=null}},u}(),p=function(){function u(C){var D=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,u),this.canvas=C,this.cxt=C.getContext("2d"),this.enable=!1!==D.enable,this.startIndex=0,this.save=[]}return u.prototype.add=function add(C){if(!C||"object"!=("undefined"==typeof C?"undefined":_typeof(C)))return!1;for(var _ref20=[C.steps,0],D=_ref20[0],E=_ref20[1],F=_ref20[2];F=D[E++];)this.initStep(F);this.save.push(C)},u.prototype.clear=function clear(){this.save=[],this.startIndex=0},u.prototype.reset=function reset(C){for(var _ref21=[this.save],D=_ref21[0],E=_ref21[1];E=D[C++];)E.hide=!1},u.prototype.pause=function pause(){this.paused=!0},u.prototype.run=function run(){this.paused=!1},u.prototype.enableEffect=function enableEffect(){this.enable=!0},u.prototype.disableEffect=function disableEffect(){this.enable=!1},u.prototype.initStep=function initStep(C){C.type=C.type||"linear",C.scaleStartX=C.scaleStartX||1,C.scaleStartY=C.scaleStartY||1,C.scaleEndX=C.scaleEndX||1,C.scaleEndY=C.scaleEndY||1,C.rotateEnd=C.rotateEnd||0,C.rotateStart=C.rotateStart||0,C.endX=C.endX||0,C.startX=C.startX||0,C.endY=C.endY||0,C.startY=C.startY||0,C.skewStartX=C.skewStartX||0,C.skewStartY=C.skewStartY||0,C.skewEndX=C.skewEndX||0,C.skewEndY=C.skewEndY||0,C.pastTime=C.pastTime||0,C.duration=C.duration||3e3,C.scaleDistX=C.scaleEndX-C.scaleStartX,C.scaleDistY=C.scaleEndY-C.scaleStartY,C.rotateDist=C.rotateEnd-C.rotateStart,C.opacity=C.opacity||1,C.fillStyle=C.fillStyle||"#ffffff",C.strokeStyle=C.strokeStyle||"#ffffff",C.radius=C.radius||10,C.distX=C.points?C.distX||0:C.endX-C.startX,C.distY=C.points?C.distY||0:C.endY-C.startY,C.skewDistX=C.skewEndX-C.skewStartX,C.skewDistY=C.skewEndY-C.skewStartY},u.prototype.getSize=function getSize(){this.width=this.canvas.width,this.height=this.canvas.height},u.prototype.clearRect=function clearRect(){this.cxt.clearRect(0,0,this.width,this.height)},u.prototype.update=function update(C,D,E){if(this.paused)return!1;var _ref22=[this.canvas,this.cxt],F=_ref22[0],G=_ref22[1];if(G.clearRect(0,0,C,D),!this.enable)return!1;for(var _ref23=[this.startIndex,this.save],H=_ref23[0],I=_ref23[1],J=_ref23[2];J=I[H++];)if(!J.hide){var M=J.steps,N=M[J.currentIndex];this.step(J,N,E),this.draw(J,N,G),this.recovery(J,N)}},u.prototype.step=function step(C,D,E){D.pastTime+=E;var _ref24=[D.type||"linear",D.pastTime,D.duration],F=_ref24[0],G=_ref24[1],H=_ref24[2];"polygon"==C.type&&this.stepCheckPolygon(D,C),D.x=this.Tween(F,G,D.startX,D.distX,H),D.y=this.Tween(F,G,D.startY,D.distY,H),D.scaleX=this.Tween(F,G,D.scaleStartX,D.scaleDistX,H),D.scaleY=this.Tween(F,G,D.scaleStartY,D.scaleDistY,H),D.rotate=this.Tween(F,G,D.rotateStart,D.rotateDist,H),D.skewX=this.Tween(F,G,D.skewStartX,D.skewDistX,H),D.skewY=this.Tween(F,G,D.skewStartY,D.skewDistY,H)},u.prototype.stepCheckPolygon=function stepCheckPolygon(C,D){var E=D.currentIndex;if(0==E){for(var F=0,G=0,H=C.points.concat([])||[],I=0,_ref25=[0],J=_ref25[0],K=_ref25[1];K=H[J++];)F+=K.x,G+=K.y,I++;if(0>=I)return!1;C.startX=F/I,C.startY=G/I,C.firstPoint=C.points.concat([]).shift()}else if(!C.points){var L=D.steps[E-1];C.startX=L.x,C.startY=L.y,C.points=L.points,C.firstPoint=L.firstPoint}},u.prototype.draw=function draw(C,D,E){E.save(),!this[C.type]||this[C.type](D,E,g,g.PI/180),E.restore()},u.prototype.rect=function rect(C,D,E,F){var _ref26=[C.x,C.y,C.width,C.height],G=_ref26[0],H=_ref26[1],I=_ref26[2],J=_ref26[3],_ref27=[E.tan(C.skewX*F),E.tan(C.skewY*F)],K=_ref27[0],L=_ref27[1];D.beginPath(),D.transform(C.scaleX,K,L,C.scaleY,G+I/2,H+J/2),D.rotate(C.rotate*E.PI/180),D.globalAlpha=C.opacity,D.rect(-I/2,-J/2,I,J),D.closePath(),D.fillStyle=C.fillStyle,D.strokeStyle=C.strokeStyle,D.fill(),D.stroke()},u.prototype.text=function text(C,D,E,F){var G=C.fontStyle||"normal",H=C.fontWeight||"normal",I=C.fontSize||"24px",J=C.fontFamily||"\u5FAE\u8F6F\u96C5\u9ED1",K=C.text||"";D.font=G+" "+H+" "+I+" "+J;var _ref28=[C.x,C.y,D.measureText(K).width,parseInt(I)],L=_ref28[0],M=_ref28[1],N=_ref28[2],O=_ref28[3],_ref29=[E.tan(C.skewX*F),E.tan(C.skewY*F)],P=_ref29[0],Q=_ref29[1];D.transform(C.scaleX,P,Q,C.scaleY,L+N/2,M+O/2),D.rotate(C.rotate*E.PI/180),D.globalAlpha=C.opacity,D.fillStyle=C.fillStyle,D.strokeStyle=C.strokeStyle,D.fillText(K,-N/2,-O/2),D.strokeText(K,-N/2,-O/2)},u.prototype.polygon=function polygon(C,D,E,F){var N=C.points,_ref30=[C.x,C.y,C.firstPoint],G=_ref30[0],H=_ref30[1],I=_ref30[2],_ref31=[E.tan(C.skewX*F),E.tan(C.skewY*F)],J=_ref31[0],K=_ref31[1];D.beginPath(),D.transform(C.scaleX,J,K,C.scaleY,G,H),D.rotate(C.rotate*E.PI/180),D.globalAlpha=C.opacity,D.fillStyle=C.fillStyle,D.strokeStyle=C.strokeStyle,D.moveTo(I.x-G,I.y-H);for(var _ref32=[0],L=_ref32[0],M=_ref32[1];M=N[L++];)D.lineTo(M.x-G,M.y-H);D.closePath(),D.fill(),D.stroke()},u.prototype.circle=function circle(C,D,E,F){var _ref33=[C.x,C.y,C.radius],G=_ref33[0],H=_ref33[1],I=_ref33[2],_ref34=[E.tan(C.skewX*F),E.tan(C.skewY*F)],J=_ref34[0],K=_ref34[1];D.beginPath(),D.transform(C.scaleX,J,K,C.scaleY,G+I,H+I),D.rotate(C.rotate*E.PI/180),D.globalAlpha=C.opacity,D.fillStyle=C.fillStyle,D.strokeStyle=C.strokeStyle,D.arc(0,0,I,0,2*E.PI,!1),D.closePath(),D.fill(),D.stroke()},u.prototype.recovery=function recovery(C,D){D.pastTime>=D.duration&&(C.currentIndex++,D.pastTime=0),C.steps[C.currentIndex]||(C.hide=!0,C.currentIndex=0)},u.prototype.Tween=function Tween(C){for(var G={linear:function linear(H,I,J,K){return J*H/K+I},easeIn:function easeIn(H,I,J,K){return J*(H/=K)*H+I},easeOut:function easeOut(H,I,J,K){return-J*(H/=K)*(H-2)+I},easeInOut:function easeInOut(H,I,J,K){return 1>(H/=K/2)?J/2*H*H+I:-J/2*(--H*(H-2)-1)+I}},E=arguments.length,D=Array(1<E?E-1:0),F=1;F<E;F++)D[F-1]=arguments[F];return!!G[C]&&G[C].apply(G,D)},u}(),q=function(){function u(z){var A=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,u),!z)throw new Error("\u6CA1\u6709\u8BBE\u7F6E\u6B63\u786E\u7684wrapper");this.wrapper=z,this.width=z.clientWidth,this.height=z.clientHeight,this.canvas=document.createElement("canvas"),this.canvas2=document.createElement("canvas"),this.normal=new o(this.canvas,A),this.effect=new p(this.canvas2,A),this.name=A.name||"",this.fps=0,this.drawing=A.auto||!1,this.startTime=new Date().getTime(),this[m](),this[l](),A.enableEvent&&this.initEvent(A)}return u.prototype[m]=function(){this.canvas.style.cssText="position:absolute;z-index:100;top:0px;left:0px;",this.canvas2.style.cssText="position:absolute;z-index:101;top:0px;left:0px;",this.setSize(),this.wrapper.appendChild(this.canvas),this.wrapper.appendChild(this.canvas2)},u.prototype[l]=function(){var z=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.normal,G=this,A=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.effect,B=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.startTime,C=new Date().getTime();if(!this.drawing)return z.clearRect(),A.clearRect(),!1;var _ref35=[this.width,this.height,C-B],D=_ref35[0],E=_ref35[1],F=_ref35[2];this.fps=1e3/F>>0,z.update(D,E,F),A.update(D,E,F),n(function(){G[l](z,A,C)})},u.prototype.initEvent=function initEvent(z){var _ref36=[this.canvas2,this.normal,!1],A=_ref36[0],B=_ref36[1],C=_ref36[2];A.onmouseup=function(D){if(D=D||event,C)return!1;if(C=!0,2==D.button){for(var _ref37=[D.target.getBoundingClientRect(),""],E=_ref37[0],F=_ref37[1],_ref38=[D.clientX-E.left,D.clientY-E.top,0,B.save],G=_ref38[0],H=_ref38[1],I=_ref38[2],J=_ref38[3],K=_ref38[4];K=J[I++];){var _ref39=[K.x,K.y,K.width+10,K.height],M=_ref39[0],N=_ref39[1],O=_ref39[2],P=_ref39[3];if(!(G<M||G>M+O||H<N-P/2||H>N+P/2||K.hide||K.recovery)){F=K;break}}var L=z.callback||function(){};L(F),C=!1}},A.oncontextmenu=function(D){D=D||event,D.preventDefault()}},u.prototype.inputData=function inputData(){var z=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return"object"==("undefined"==typeof z?"undefined":_typeof(z))&&z.type&&void this.normal.add(z)},u.prototype.inputEffect=function inputEffect(){var z=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return"object"==("undefined"==typeof z?"undefined":_typeof(z))&&z.type&&z.steps&&void this.effect.add(z)},u.prototype.clear=function clear(){this.normal.clear(),this.effect.clear()},u.prototype.reset=function reset(z,A){this.normal.reset(z),this.effect.reset(A)},u.prototype.pause=function pause(){this.normal.pause(),this.effect.pause()},u.prototype.run=function run(){this.normal.run(),this.effect.run()},u.prototype.addFilter=function addFilter(z,A){this.normal.addFilter(z,A)},u.prototype.removeFilter=function removeFilter(z,A){this.normal.removeFilter(z,A)},u.prototype.disableEffect=function disableEffect(){this.effect.disableEffect()},u.prototype.enableEffect=function enableEffect(){this.effect.enableEffect()},u.prototype.setSize=function setSize(){var z=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.width,A=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.height;return!Number.isInteger(z)||0>z||!Number.isInteger(A)||0>A?!1:void(this.width=z,this.height=A,this.canvas.width=z,this.canvas.height=A,this.canvas2.width=z,this.canvas2.height=A,this.normal.getSize(),this.effect.getSize())},u.prototype.getSize=function getSize(){return{width:this.width,height:this.height}},u.prototype.changeStyle=function changeStyle(){var z=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.normal.changeStyle(z)},u.prototype.addGradient=function addGradient(z,A){this.normal.addGradient(z,A)},u.prototype.start=function start(){return!this.drawing&&void(this.drawing=!0,this[l]())},u.prototype.stop=function stop(){this.drawing=!1},u.prototype.getFPS=function getFPS(){return this.fps},u}(),s=function(u,z){var A=new Proxy(new q(u,z),{get:function get(C,D){return"function"==typeof C[D]?C[D].bind(C):C[D]}}),B=A;return{pause:B.pause,run:B.run,start:B.start,stop:B.stop,changeStyle:B.changeStyle,addGradient:B.addGradient,setSize:B.setSize,inputData:B.inputData,inputEffect:B.inputEffect,clear:B.clear,reset:B.reset,addFilter:B.addFilter,removeFilter:B.removeFilter,disableEffect:B.disableEffect,enableEffect:B.enableEffect,getSize:B.getSize,getFPS:B.getFPS}};"undefined"!=typeof module&&module.exports?module.exports=s:"function"==typeof define&&define.amd?define(function(){return s}):f.DanMuer=s})(window,Math);